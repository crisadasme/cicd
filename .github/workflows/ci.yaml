name: CI

on: [push]

env:
  AWS_REGION: us-east-1
  PROJECT_NAME: "PROJECT"
  VERSION: "v1.0.0"
  BRANCH_NAME: ${{ github.head_ref || github.ref_name }} 

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - name: Install dependencies
        run: |
          echo '1) Installing dependencies'
          if ${{ env.BRANCH_NAME }} == 'develop'
          then
            export ENV=DEV
          elif ${{ env.BRANCH_NAME }} == 'main
          then
            export ENV=PROD
          fi
          echo Working environment: "$ENV"
          make install-dependencies ENV=$ENV

      - name: Run Lintern
        run: |
          echo '2) Running Lint'
          make run-lintern

      - name: Run Tests
        run: |
          echo '3) Running Tests' 
          make run-tests

  # push-image:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v2
  #   - uses: docker://ghcr.io/kciter/aws-ecr-action:latest
  #     with:
  #       access_key_id: ${{ secrets.AWS_ACCESS_KEY_ID }}
  #       secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #       account_id: ${{ secrets.AWS_ACCOUNT_ID }}
  #       repo: ${{ secrets.ECR_REPOSITORY }}
  #       region: ${{ env.AWS_REGION }}
  #       tags: latest,${{ github.sha }}
  #       create_repo: no
  #       image_scanning_configuration: true
  #       set_repo_policy: false